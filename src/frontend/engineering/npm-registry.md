---
title: NPM ç§æœ
icon: mdi:tools
category:
  - å‰ç«¯å·¥ç¨‹åŒ–
tag:
  - NPM
  - ç§æœ
  - åŒ…ç®¡ç†
  - Verdaccio
  - DevOps
---

# NPM ç§æœ

## 1. ä»€ä¹ˆæ˜¯ NPM ç§æœ

**npm ç§æœï¼ˆPrivate npm Registryï¼‰** æ˜¯ä¼ä¸šæˆ–å›¢é˜Ÿå†…éƒ¨æ­å»ºçš„ç§æœ‰ npm ä»“åº“ï¼Œç”¨äºå­˜å‚¨ã€ç®¡ç†å’Œåˆ†å‘å†…éƒ¨å¼€å‘çš„ npm åŒ…ï¼ŒåŒæ—¶å¯ä»¥ç¼“å­˜å…¬å…± npm ä»“åº“ï¼ˆå¦‚ npmjs.comï¼‰çš„åŒ…ï¼Œå…¼å…· **"ç§æœ‰åŒ…ç®¡ç†"** å’Œ **"å…¬å…±åŒ…åŠ é€Ÿ"** çš„åŒé‡ä½œç”¨ã€‚

### 1.1 æ¶æ„ç¤ºæ„å›¾

```
å¼€å‘è€…
  â†“
npm install/publish
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     NPM ç§æœï¼ˆå†…ç½‘ï¼‰          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  ç§æœ‰åŒ…ä»“åº“  â”‚  å…¬å…±åŒ…ç¼“å­˜  â”‚â”‚
â”‚  â”‚ (å†…éƒ¨å¼€å‘) â”‚  (npmé•œåƒ) â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ (æœªç¼“å­˜æ—¶)
    å…¬å…± npm ä»“åº“
   (npmjs.com)
```

### 1.2 æ ¸å¿ƒæ¦‚å¿µ

- **ç§æœ‰ä»“åº“ï¼š** å­˜å‚¨ä¼ä¸šå†…éƒ¨å¼€å‘çš„ç§æœ‰ npm åŒ…
- **ç¼“å­˜ä»£ç†ï¼š** ç¼“å­˜å…¬å…± npm åŒ…ï¼ŒåŠ é€Ÿä¸‹è½½
- **æƒé™ç®¡ç†ï¼š** æ§åˆ¶è°å¯ä»¥å‘å¸ƒå’Œä¸‹è½½åŒ…
- **ç‰ˆæœ¬ç®¡ç†ï¼š** æ”¯æŒè¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶

## 2. NPM ç§æœçš„ä½œç”¨

### 2.1 ç§æœ‰åŒ…å®‰å…¨ç®¡ç†

**é—®é¢˜åœºæ™¯ï¼š**
```javascript
// ä¼ä¸šå†…éƒ¨çš„å·¥å…·åº“
// âŒ ä¸èƒ½å‘å¸ƒåˆ°å…¬å…± npm
@company/auth-utils
@company/payment-sdk
@company/ui-components
```

**è§£å†³æ–¹æ¡ˆï¼š**
- âœ… ä¼ä¸šå†…éƒ¨å¼€å‘çš„å·¥å…·åº“ã€ç»„ä»¶åº“ç­‰æ•æ„Ÿä»£ç ï¼Œä¸é€‚åˆå‘å¸ƒåˆ°å…¬å…± npm ä»“åº“
- âœ… é€šè¿‡ç§æœå¯å®ç°æƒé™ç®¡æ§ï¼ˆå¦‚ä»…å›¢é˜Ÿæˆå‘˜å¯è®¿é—®ï¼‰
- âœ… é˜²æ­¢ä»£ç æ³„éœ²å’ŒçŸ¥è¯†äº§æƒæŸå¤±

**ç¤ºä¾‹ï¼š**
```bash
# å‘å¸ƒå†…éƒ¨åŒ…åˆ°ç§æœï¼ˆå¤–éƒ¨æ— æ³•è®¿é—®ï¼‰
npm publish @company/auth-utils --registry http://npm.company.com
```

### 2.2 å›¢é˜Ÿåä½œæ•ˆç‡æå‡

**ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜ï¼š**
```
å¼€å‘è€… A å¼€å‘äº†å·¥å…·åº“
  â†“
æ‰‹åŠ¨å‘é€ä»£ç ç»™å¼€å‘è€… B
  â†“
å¼€å‘è€… B å¤åˆ¶ç²˜è´´åˆ°é¡¹ç›®
  â†“
ç‰ˆæœ¬æ›´æ–°åéœ€è¦é‡æ–°å‘é€
  â†“
å®¹æ˜“é€ æˆç‰ˆæœ¬æ··ä¹±
```

**ä½¿ç”¨ç§æœçš„ä¼˜åŠ¿ï¼š**
```
å¼€å‘è€… A å‘å¸ƒåˆ°ç§æœ
  â†“
å¼€å‘è€… B ç›´æ¥ npm install
  â†“
æ”¯æŒç‰ˆæœ¬ç®¡ç†ï¼ˆå‡çº§ã€å›æ»šï¼‰
  â†“
é¿å…ä»£ç é‡å¤å¼€å‘
```

**ç¤ºä¾‹ï¼š**
```bash
# å›¢é˜Ÿæˆå‘˜ç›´æ¥å®‰è£…
npm install @company/auth-utils@1.2.0

# å‡çº§ç‰ˆæœ¬
npm update @company/auth-utils

# å›æ»šåˆ°æ—§ç‰ˆæœ¬
npm install @company/auth-utils@1.0.0
```

### 2.3 å…¬å…±åŒ…ç¼“å­˜åŠ é€Ÿ

**å·¥ä½œæœºåˆ¶ï¼š**

```
é¦–æ¬¡å®‰è£… react
  â†“
ç§æœæ£€æŸ¥æœ¬åœ°ç¼“å­˜
  â†“ (æœªç¼“å­˜)
ä» npmjs.com ä¸‹è½½
  â†“
ç¼“å­˜åˆ°ç§æœ
  â†“
è¿”å›ç»™å¼€å‘è€…

åç»­å®‰è£… react
  â†“
ç§æœæ£€æŸ¥æœ¬åœ°ç¼“å­˜
  â†“ (å·²ç¼“å­˜)
ç›´æ¥ä»ç§æœè¿”å› âœ…
```

**é€Ÿåº¦å¯¹æ¯”ï¼š**

| åœºæ™¯ | æ— ç§æœ | æœ‰ç§æœ |
|------|--------|--------|
| é¦–æ¬¡å®‰è£… | 3-5 åˆ†é’Ÿ | 3-5 åˆ†é’Ÿ |
| åç»­å®‰è£… | 3-5 åˆ†é’Ÿ | 10-30 ç§’ |
| ç½‘ç»œæ•…éšœ | âŒ æ— æ³•å®‰è£… | âœ… ä»ç¼“å­˜å®‰è£… |

### 2.4 è§„èŒƒåŒ…å‘å¸ƒæµç¨‹

**é›†æˆ CI/CD æµç¨‹ï¼š**

```
ä»£ç æäº¤
  â†“
è‡ªåŠ¨è¿è¡Œæµ‹è¯•
  â†“
ä»£ç å®¡æŸ¥
  â†“
æ„å»ºæ‰“åŒ…
  â†“
å‘å¸ƒåˆ°ç§æœï¼ˆè‡ªåŠ¨åŒ–ï¼‰
  â†“
é€šçŸ¥å›¢é˜Ÿæˆå‘˜
```

**è´¨é‡ä¿è¯ï¼š**
- âœ… ä»£ç é£æ ¼æ£€æŸ¥ï¼ˆESLintï¼‰
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡è¦æ±‚
- âœ… æ„å»ºæˆåŠŸæ‰èƒ½å‘å¸ƒ
- âœ… é¿å…"å¸¦ç—…åŒ…"è¿›å…¥å¼€å‘æµç¨‹

## 3. å¸¸è§çš„ NPM ç§æœ

### 3.1 ç§æœå·¥å…·å¯¹æ¯”

| å·¥å…·åç§° | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|---------|------|---------|
| **Verdaccio** | - è½»é‡å¼€æºï¼ˆåŸºäº Node.jsï¼‰<br>- é…ç½®ç®€å•<br>- æ”¯æŒç§æœ‰åŒ… + ç¼“å­˜å…¬å…±åŒ…<br>- æ— å¤–éƒ¨ä¾èµ– | - ä¸­å°å‹å›¢é˜Ÿ<br>- ä¸ªäººé¡¹ç›®<br>- å¿«é€Ÿæ­å»º |
| **Nexus** | - åŠŸèƒ½å¼ºå¤§<br>- æ”¯æŒå¤šç§ä»“åº“ï¼ˆnpmã€Mavenã€Dockerç­‰ï¼‰<br>- ä¼ä¸šçº§å®‰å…¨ä¸æƒé™ç®¡ç† | - å¤§å‹ä¼ä¸š<br>- å¤šè¯­è¨€æŠ€æœ¯æ ˆå›¢é˜Ÿ |
| **Artifactory** | - ä¸“æ³¨ DevOps é›†æˆ<br>- å¤æ‚çš„æƒé™æ§åˆ¶<br>- åŒ…ç”Ÿå‘½å‘¨æœŸç®¡ç†<br>- å•†ä¸šè½¯ä»¶ï¼ˆæœ‰å…è´¹ç‰ˆï¼‰ | - å¯¹ CI/CD æµç¨‹<br>  è¦æ±‚é«˜çš„å›¢é˜Ÿ |
| **cnpmjs.org** | - æ·˜å®å›¢é˜Ÿå¼€æº<br>- å…¼å®¹ npm å‘½ä»¤<br>- æ”¯æŒç§æœ‰åŒ…å’Œé•œåƒåŠŸèƒ½ | - ç†Ÿæ‚‰ Node.js<br>  ç”Ÿæ€çš„å›¢é˜Ÿ |

### 3.2 Verdaccioï¼ˆæ¨èå…¥é—¨ï¼‰

**ä¼˜ç‚¹ï¼š**
- ğŸš€ å®‰è£…ç®€å•ï¼ˆä¸€æ¡å‘½ä»¤ï¼‰
- âš¡ å¯åŠ¨å¿«é€Ÿï¼ˆæ— éœ€æ•°æ®åº“ï¼‰
- ğŸ“¦ åŠŸèƒ½å®Œæ•´ï¼ˆæ»¡è¶³å¤§éƒ¨åˆ†éœ€æ±‚ï¼‰
- ğŸ”§ é…ç½®çµæ´»ï¼ˆYAML é…ç½®æ–‡ä»¶ï¼‰

**å®‰è£…ç¤ºä¾‹ï¼š**
```bash
# å…¨å±€å®‰è£…
npm install -g verdaccio

# å¯åŠ¨æœåŠ¡
verdaccio

# è¾“å‡ºï¼š
# warn --- config file - /root/.config/verdaccio/config.yaml
# warn --- http address - http://localhost:4873/
```

## 4. NPM ç§æœå·¥ä½œæµç¨‹

### 4.1 å®Œæ•´æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. æ­å»ºç§æœï¼ˆå®‰è£… Verdaccioï¼‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. é…ç½® npm æºæŒ‡å‘ç§æœ              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. å‘å¸ƒç§æœ‰åŒ…åˆ°ç§æœ                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. å›¢é˜Ÿæˆå‘˜å®‰è£…åŒ…                   â”‚
â”‚     - ç§æœ‰åŒ…ï¼šç›´æ¥ä»ç§æœä¸‹è½½         â”‚
â”‚     - å…¬å…±åŒ…ï¼šç§æœç¼“å­˜åè¿”å›         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. æƒé™ç®¡ç†å’Œç‰ˆæœ¬æ§åˆ¶               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 æ­¥éª¤è¯¦è§£

#### æ­¥éª¤ 1ï¼šæ­å»ºç§æœ

```bash
# å®‰è£… Verdaccio
npm install -g verdaccio

# å¯åŠ¨æœåŠ¡ï¼ˆé»˜è®¤åœ°å€ http://localhost:4873ï¼‰
verdaccio

# åå°è¿è¡Œï¼ˆæ¨èä½¿ç”¨ PM2ï¼‰
pm2 start verdaccio
```

#### æ­¥éª¤ 2ï¼šé…ç½® npm æº

```bash
# æ–¹å¼ 1ï¼šä¸´æ—¶åˆ‡æ¢ï¼ˆæ¨èï¼‰
npm install <package> --registry http://localhost:4873

# æ–¹å¼ 2ï¼šå…¨å±€åˆ‡æ¢
npm set registry http://localhost:4873

# æ–¹å¼ 3ï¼šä½¿ç”¨ nrm ç®¡ç†ï¼ˆæ¨èï¼‰
npm install -g nrm
nrm add private http://localhost:4873
nrm use private

# æŸ¥çœ‹å½“å‰æº
npm get registry
```

#### æ­¥éª¤ 3ï¼šå‘å¸ƒç§æœ‰åŒ…

```bash
# 1. æ³¨å†Œç§æœè´¦å·ï¼ˆé¦–æ¬¡å‘å¸ƒéœ€è¦ï¼‰
npm adduser --registry http://localhost:4873
# Username: your-name
# Password: your-password
# Email: your-email@example.com

# 2. å‘å¸ƒåŒ…åˆ°ç§æœ
npm publish --registry http://localhost:4873

# æˆ–è€…åœ¨ package.json ä¸­é…ç½® publishConfig
```

#### æ­¥éª¤ 4ï¼šå®‰è£…åŒ…

**å®‰è£…ç§æœ‰åŒ…ï¼š**
```bash
npm install @company/auth-utils
# ç›´æ¥ä»ç§æœä¸‹è½½ï¼ˆç§æœä¸­å·²å­˜åœ¨ï¼‰
```

**å®‰è£…å…¬å…±åŒ…ï¼š**
```bash
npm install react
# 1. ç§æœæ£€æŸ¥æœ¬åœ°ç¼“å­˜
# 2. è‹¥æœªç¼“å­˜ï¼Œä» npmjs.com ä¸‹è½½
# 3. ç¼“å­˜åˆ°ç§æœ
# 4. è¿”å›ç»™ç”¨æˆ·
```

#### æ­¥éª¤ 5ï¼šæƒé™ç®¡ç†

**é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼ˆconfig.yamlï¼‰ï¼š**
```yaml
# æƒé™é…ç½®
packages:
  '@company/*':
    access: $authenticated  # åªæœ‰ç™»å½•ç”¨æˆ·å¯è®¿é—®
    publish: $authenticated # åªæœ‰ç™»å½•ç”¨æˆ·å¯å‘å¸ƒ
    
  '**':
    access: $all           # æ‰€æœ‰äººå¯è®¿é—®å…¬å…±åŒ…
    publish: $authenticated # éœ€è¦ç™»å½•æ‰èƒ½å‘å¸ƒ
```

## 5. å¦‚ä½•åœ¨ NPM ç§æœä¸­å‘å¸ƒä¸€ä¸ªåŒ…

### 5.1 å‘å¸ƒå‰å‡†å¤‡

#### 1. ç¡®ä¿å·²æ­å»º npm ç§æœ

```bash
# æ£€æŸ¥ç§æœæ˜¯å¦å¯è®¿é—®
curl http://192.168.1.100:4873

# æˆ–åœ¨æµè§ˆå™¨è®¿é—®
http://192.168.1.100:4873
```

#### 2. åˆå§‹åŒ–åŒ…é¡¹ç›®

```bash
# åˆ›å»ºæ–°é¡¹ç›®
mkdir my-private-package && cd my-private-package

# åˆå§‹åŒ– package.json
npm init -y
```

#### 3. é…ç½® package.jsonï¼ˆå…³é”®ï¼‰

```json
{
  "name": "@your-org/package-name",  // âœ… å»ºè®®ç”¨ç»„ç»‡åå‰ç¼€ï¼Œé¿å…ä¸å…¬å…±åŒ…å†²çª
  "version": "1.0.0",                // âœ… éµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼ˆmajor.minor.patchï¼‰
  "description": "My private package",
  "main": "index.js",                // âœ… å…¥å£æ–‡ä»¶
  "private": false,                  // âœ… å¿…é¡»è®¾ä¸º false æ‰èƒ½å‘å¸ƒ
  "publishConfig": {
    "registry": "http://npm.company.com"  // âœ… æŒ‡å®šå‘å¸ƒåˆ°ç§æœ
  },
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": ["private", "utils"],
  "author": "Your Name",
  "license": "MIT"
}
```

#### 4. å‡†å¤‡åŒ…å†…å®¹

```javascript
// index.js
module.exports = {
  sayHello: () => {
    console.log("Hello from private package!");
  },
  
  add: (a, b) => {
    return a + b;
  }
};
```

**åˆ›å»º README.mdï¼š**
```markdown
# @your-org/package-name

ä¼ä¸šå†…éƒ¨å·¥å…·åŒ…

## å®‰è£…

\`\`\`bash
npm install @your-org/package-name
\`\`\`

## ä½¿ç”¨

\`\`\`javascript
const utils = require('@your-org/package-name');
utils.sayHello();
\`\`\`
```

**åˆ›å»º .npmignoreï¼š**
```
node_modules/
test/
.env
*.log
.DS_Store
```

### 5.2 å‘å¸ƒæ­¥éª¤ï¼ˆ5 æ­¥å®Œæˆï¼‰

#### æ­¥éª¤ 1ï¼šåˆ‡æ¢ npm æºåˆ°ç§æœ

```bash
# æ–¹å¼ 1ï¼šä¸´æ—¶åˆ‡æ¢ï¼ˆæ¨èï¼Œä¸å½±å“å…¨å±€é…ç½®ï¼‰
npm set registry http://192.168.1.100:4873

# æ–¹å¼ 2ï¼šä½¿ç”¨ nrm å·¥å…·ç®¡ç†æºï¼ˆæ¨èï¼‰
# å…ˆå®‰è£… nrm
npm install -g nrm

# æ·»åŠ ç§æœæº
nrm add private http://192.168.1.100:4873

# åˆ‡æ¢åˆ°ç§æœæº
nrm use private

# æŸ¥çœ‹å½“å‰æº
nrm current
```

#### æ­¥éª¤ 2ï¼šç™»å½•ç§æœï¼ˆé¦–æ¬¡å‘å¸ƒéœ€æ‰§è¡Œï¼‰

```bash
npm login

# æŒ‰æç¤ºè¾“å…¥ï¼š
# Username: your-username
# Password: your-password
# Email: (this IS public) your-email@example.com
```

**éªŒè¯ç™»å½•çŠ¶æ€ï¼š**
```bash
npm whoami
# è¾“å‡ºï¼šyour-username
```

**ç™»å½•å‡­è¯ä½ç½®ï¼š**
```bash
# å‡­è¯ä¿å­˜åœ¨ ~/.npmrc
cat ~/.npmrc
# //192.168.1.100:4873/:_authToken="your-token"
```

#### æ­¥éª¤ 3ï¼šæ£€æŸ¥åŒ…é…ç½®ï¼ˆé¿å…å‘å¸ƒå¤±è´¥ï¼‰

**æ£€æŸ¥æ¸…å•ï¼š**

```bash
# 1. æ£€æŸ¥åŒ…åæ˜¯å¦å·²å­˜åœ¨
npm view @your-org/package-name
# å¦‚æœè¿”å› 404ï¼Œè¯´æ˜åŒ…åå¯ç”¨

# 2. æ£€æŸ¥ç‰ˆæœ¬å·
npm view @your-org/package-name versions
# ç¡®ä¿æ–°ç‰ˆæœ¬å·æœªè¢«ä½¿ç”¨

# 3. æ£€æŸ¥ package.json é…ç½®
cat package.json | grep -E "name|version|main|private"

# 4. æµ‹è¯•æœ¬åœ°åŒ…
npm link
cd /path/to/test-project
npm link @your-org/package-name
```

**å¸¸è§é—®é¢˜æ£€æŸ¥ï¼š**
- âœ… `name` ä¸èƒ½ä¸ç§æœä¸­å·²å­˜åœ¨çš„åŒ…é‡å
- âœ… `version` éœ€ä¸ºæ–°ç‰ˆæœ¬ï¼ˆè‹¥å·²å‘å¸ƒè¿‡ 1.0.0ï¼Œéœ€æ›´æ–°ä¸º 1.0.1 æˆ– 1.1.0ï¼‰
- âœ… `private` å¿…é¡»ä¸º `false`
- âœ… ç¡®ä¿æ— æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†é’¥ã€å¯†ç ï¼‰
- âœ… `.npmignore` æ’é™¤ä¸éœ€è¦å‘å¸ƒçš„æ–‡ä»¶

#### æ­¥éª¤ 4ï¼šå‘å¸ƒåŒ…åˆ°ç§æœ

```bash
# å‘å¸ƒåˆ°ç§æœ
npm publish

# å¦‚æœéœ€è¦æŒ‡å®š registry
npm publish --registry http://192.168.1.100:4873

# å¦‚æœåŒ…åå¸¦æœ‰ scopeï¼ˆå¦‚ @company/packageï¼‰
npm publish --access public
```

**æˆåŠŸåæ˜¾ç¤ºï¼š**
```bash
npm notice 
npm notice ğŸ“¦  @your-org/package-name@1.0.0
npm notice === Tarball Contents === 
npm notice 123B index.js       
npm notice 456B package.json   
npm notice 789B README.md      
npm notice === Tarball Details === 
npm notice name:          @your-org/package-name                  
npm notice version:       1.0.0                                   
npm notice package size:  1.4 kB                                  
npm notice unpacked size: 1.4 kB                                  
npm notice shasum:        abc123def456...                         
npm notice integrity:     sha512-xyz789...                       
npm notice total files:   3                                       
npm notice 
+ @your-org/package-name@1.0.0
```

#### æ­¥éª¤ 5ï¼šéªŒè¯å‘å¸ƒç»“æœ

```bash
# æ–¹å¼ 1ï¼šæŸ¥çœ‹åŒ…ä¿¡æ¯
npm view @your-org/package-name

# è¾“å‡ºï¼š
# @your-org/package-name@1.0.0 | MIT | deps: none | versions: 1
# My private package
# http://192.168.1.100:4873/@your-org/package-name

# æ–¹å¼ 2ï¼šåœ¨æµè§ˆå™¨è®¿é—®ç§æœ
http://192.168.1.100:4873

# æ–¹å¼ 3ï¼šæµ‹è¯•å®‰è£…
cd /tmp
mkdir test-install && cd test-install
npm install @your-org/package-name
node -e "console.log(require('@your-org/package-name'))"
```

## 6. ç‰ˆæœ¬ç®¡ç†æœ€ä½³å®è·µ

### 6.1 è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼ˆSemVerï¼‰

**ç‰ˆæœ¬æ ¼å¼ï¼š** `ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·`ï¼ˆ`MAJOR.MINOR.PATCH`ï¼‰

```
1.2.3
â”‚ â”‚ â””â”€ PATCHï¼šä¿®å¤ bugï¼Œå‘åå…¼å®¹
â”‚ â””â”€â”€â”€ MINORï¼šæ–°å¢åŠŸèƒ½ï¼Œå‘åå…¼å®¹
â””â”€â”€â”€â”€â”€ MAJORï¼šé‡å¤§æ›´æ–°ï¼Œå¯èƒ½ä¸å…¼å®¹
```

**æ›´æ–°ç‰ˆæœ¬å‘½ä»¤ï¼š**
```bash
# ä¿®å¤ bugï¼š1.0.0 â†’ 1.0.1
npm version patch

# æ–°å¢åŠŸèƒ½ï¼š1.0.1 â†’ 1.1.0
npm version minor

# é‡å¤§æ›´æ–°ï¼š1.1.0 â†’ 2.0.0
npm version major

# è‡ªåŠ¨æäº¤ git
npm version patch -m "fix: ä¿®å¤ç™»å½•bug"
```

### 6.2 å‘å¸ƒæµç¨‹è‡ªåŠ¨åŒ–

**package.json æ·»åŠ è„šæœ¬ï¼š**
```json
{
  "scripts": {
    "prepublishOnly": "npm run test && npm run build",
    "test": "jest",
    "build": "rollup -c",
    "release": "npm version patch && npm publish"
  }
}
```

**ä½¿ç”¨ npm é’©å­ï¼š**
```bash
# prepublishOnlyï¼šå‘å¸ƒå‰è‡ªåŠ¨è¿è¡Œ
# preversionï¼šç‰ˆæœ¬å·æ›´æ–°å‰è¿è¡Œ
# postversionï¼šç‰ˆæœ¬å·æ›´æ–°åè¿è¡Œ
```

## 7. å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### Q1ï¼šå‘å¸ƒå¤±è´¥ï¼š403 Forbidden

**åŸå› ï¼š** æœªç™»å½•æˆ–æƒé™ä¸è¶³

**è§£å†³ï¼š**
```bash
# é‡æ–°ç™»å½•
npm login --registry http://npm.company.com

# æ£€æŸ¥æƒé™é…ç½®
cat ~/.config/verdaccio/config.yaml
```

### Q2ï¼šå‘å¸ƒå¤±è´¥ï¼šç‰ˆæœ¬å·²å­˜åœ¨

**åŸå› ï¼š** ç‰ˆæœ¬å·é‡å¤

**è§£å†³ï¼š**
```bash
# æ›´æ–°ç‰ˆæœ¬å·
npm version patch

# æˆ–æ‰‹åŠ¨ä¿®æ”¹ package.json ä¸­çš„ version
```

### Q3ï¼šå®‰è£…åŒ…æ—¶æ‰¾ä¸åˆ°

**åŸå› ï¼š** npm æºæœªæŒ‡å‘ç§æœ

**è§£å†³ï¼š**
```bash
# æ£€æŸ¥å½“å‰æº
npm get registry

# åˆ‡æ¢åˆ°ç§æœ
npm set registry http://npm.company.com

# æˆ–åœ¨å®‰è£…æ—¶æŒ‡å®š
npm install <package> --registry http://npm.company.com
```

### Q4ï¼šç§æœç¼“å­˜çš„å…¬å…±åŒ…ç‰ˆæœ¬è¿‡æ—§

**åŸå› ï¼š** ç§æœç¼“å­˜æœªæ›´æ–°

**è§£å†³ï¼š**
```bash
# æ¸…é™¤æœ¬åœ°ç¼“å­˜
npm cache clean --force

# å¼ºåˆ¶ä»æºé‡æ–°ä¸‹è½½
npm install <package> --force
```

### Q5ï¼šå¦‚ä½•åˆ é™¤å·²å‘å¸ƒçš„åŒ…

**Verdaccioï¼š**
```bash
# åˆ é™¤æŒ‡å®šç‰ˆæœ¬
npm unpublish @your-org/package-name@1.0.0

# åˆ é™¤æ‰€æœ‰ç‰ˆæœ¬ï¼ˆæ…ç”¨ï¼‰
npm unpublish @your-org/package-name --force
```

## 8. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å»ºè®®

### 8.1 ä½¿ç”¨ Docker éƒ¨ç½²

```dockerfile
# Dockerfile
FROM verdaccio/verdaccio:latest

# å¤åˆ¶è‡ªå®šä¹‰é…ç½®
COPY config.yaml /verdaccio/conf/config.yaml

# æš´éœ²ç«¯å£
EXPOSE 4873

# æ•°æ®æŒä¹…åŒ–
VOLUME /verdaccio/storage
```

**å¯åŠ¨å®¹å™¨ï¼š**
```bash
docker run -d \
  --name verdaccio \
  -p 4873:4873 \
  -v /path/to/storage:/verdaccio/storage \
  -v /path/to/config.yaml:/verdaccio/conf/config.yaml \
  verdaccio/verdaccio
```

### 8.2 é…ç½®åå‘ä»£ç†ï¼ˆNginxï¼‰

```nginx
server {
  listen 80;
  server_name npm.company.com;
  
  location / {
    proxy_pass http://localhost:4873;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }
}
```

### 8.3 é…ç½® HTTPS

```bash
# ä½¿ç”¨ Let's Encrypt è·å–å…è´¹è¯ä¹¦
certbot --nginx -d npm.company.com
```

### 8.4 ç›‘æ§å’Œæ—¥å¿—

```bash
# ä½¿ç”¨ PM2 ç®¡ç†è¿›ç¨‹
pm2 start verdaccio

# æŸ¥çœ‹æ—¥å¿—
pm2 logs verdaccio

# ç›‘æ§çŠ¶æ€
pm2 monit
```

## 9. æ€»ç»“

### 9.1 æ ¸å¿ƒè¦ç‚¹

- ğŸ“¦ **ç§æœæœ¬è´¨ï¼š** ç§æœ‰åŒ…ä»“åº“ + å…¬å…±åŒ…ç¼“å­˜ä»£ç†
- ğŸ”’ **ä¸»è¦ä»·å€¼ï¼š** ä»£ç å®‰å…¨ã€åä½œæ•ˆç‡ã€ä¸‹è½½åŠ é€Ÿ
- ğŸ› ï¸ **æ¨èå·¥å…·ï¼š** Verdaccioï¼ˆä¸­å°å›¢é˜Ÿï¼‰ã€Nexusï¼ˆå¤§å‹ä¼ä¸šï¼‰
- ğŸ“‹ **å‘å¸ƒæµç¨‹ï¼š** é…ç½®æº â†’ ç™»å½• â†’ æ£€æŸ¥ â†’ å‘å¸ƒ â†’ éªŒè¯

### 9.2 æœ€ä½³å®è·µ

- âœ… ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬ç®¡ç†
- âœ… å‘å¸ƒå‰è‡ªåŠ¨è¿è¡Œæµ‹è¯•
- âœ… é…ç½® `.npmignore` æ’é™¤æ— ç”¨æ–‡ä»¶
- âœ… ä½¿ç”¨ `publishConfig` æŒ‡å®šå‘å¸ƒç›®æ ‡
- âœ… ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Docker + Nginx éƒ¨ç½²

---

> ğŸ’¡ **æ ¸å¿ƒè¦ç‚¹ï¼š** NPM ç§æœæ˜¯ä¼ä¸šçº§å‰ç«¯å·¥ç¨‹åŒ–çš„é‡è¦åŸºç¡€è®¾æ–½ï¼Œå…¼é¡¾ä»£ç å®‰å…¨å’Œå¼€å‘æ•ˆç‡ï¼Œæ¨èä¸­å°å›¢é˜Ÿä½¿ç”¨ Verdaccio å¿«é€Ÿæ­å»ºã€‚
