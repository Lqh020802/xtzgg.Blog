<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript äº‹ä»¶å¾ªç¯æ¼”ç¤º</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1, h2 {
            color: #333;
            border-bottom: 2px solid #007acc;
            padding-bottom: 10px;
        }
        .example {
            background: #f8f9fa;
            border-left: 4px solid #007acc;
            padding: 15px;
            margin: 15px 0;
        }
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            margin: 10px 0;
        }
        .output {
            background: #1a202c;
            color: #68d391;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            margin: 10px 0;
            border: 1px solid #4a5568;
        }
        button {
            background: #007acc;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: background 0.3s;
        }
        button:hover {
            background: #005a9e;
        }
        .task-type {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin: 2px;
        }
        .sync { background: #ffcdd2; color: #c62828; }
        .micro { background: #f3e5f5; color: #7b1fa2; }
        .macro { background: #fff3e0; color: #ef6c00; }
        .visual-demo {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .queue {
            background: #f0f0f0;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            min-height: 100px;
        }
        .queue h3 {
            margin-top: 0;
            text-align: center;
        }
        .task-item {
            background: white;
            padding: 8px;
            margin: 5px 0;
            border-radius: 4px;
            border-left: 4px solid #007acc;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .executing {
            background: #ffeb3b !important;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”„ JavaScript äº‹ä»¶å¾ªç¯æ¼”ç¤º</h1>
        
        <div class="example">
            <h2>ğŸ“š åŸºç¡€æ¦‚å¿µ</h2>
            <p><strong>äº‹ä»¶å¾ªç¯</strong>æ˜¯JavaScriptå¤„ç†å¼‚æ­¥æ“ä½œçš„æ ¸å¿ƒæœºåˆ¶ï¼Œå®ƒå†³å®šäº†ä»£ç çš„æ‰§è¡Œé¡ºåºã€‚</p>
            <ul>
                <li><span class="task-type sync">åŒæ­¥ä»»åŠ¡</span> - ç«‹å³æ‰§è¡Œï¼Œé˜»å¡åç»­ä»£ç </li>
                <li><span class="task-type micro">å¾®ä»»åŠ¡</span> - Promise.thenã€queueMicrotaskç­‰</li>
                <li><span class="task-type macro">å®ä»»åŠ¡</span> - setTimeoutã€setIntervalã€I/Oç­‰</li>
            </ul>
        </div>

        <div class="example">
            <h2>ğŸ¯ æ‰§è¡Œé¡ºåºæ¼”ç¤º</h2>
            <p>ç‚¹å‡»æŒ‰é’®æŸ¥çœ‹ä¸åŒä»»åŠ¡çš„æ‰§è¡Œé¡ºåºï¼š</p>
            
            <button onclick="runBasicExample()">åŸºç¡€ç¤ºä¾‹</button>
            <button onclick="runComplexExample()">å¤æ‚ç¤ºä¾‹</button>
            <button onclick="runNestedExample()">åµŒå¥—ç¤ºä¾‹</button>
            <button onclick="clearOutput()">æ¸…ç©ºè¾“å‡º</button>
            
            <div class="visual-demo">
                <div class="queue">
                    <h3>ğŸ“‹ è°ƒç”¨æ ˆ</h3>
                    <div id="call-stack"></div>
                </div>
                <div class="queue">
                    <h3>âš¡ å¾®ä»»åŠ¡é˜Ÿåˆ—</h3>
                    <div id="micro-queue"></div>
                </div>
                <div class="queue">
                    <h3>â° å®ä»»åŠ¡é˜Ÿåˆ—</h3>
                    <div id="macro-queue"></div>
                </div>
            </div>
            
            <div class="output" id="output">
                <div>æ§åˆ¶å°è¾“å‡ºå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
            </div>
        </div>

        <div class="example">
            <h2>ğŸ“ ä»£ç ç¤ºä¾‹</h2>
            
            <h3>ç¤ºä¾‹ 1: åŸºç¡€æ‰§è¡Œé¡ºåº</h3>
            <div class="code-block">
console.log('1'); // åŒæ­¥ä»»åŠ¡

setTimeout(() => {
    console.log('2'); // å®ä»»åŠ¡
}, 0);

Promise.resolve().then(() => {
    console.log('3'); // å¾®ä»»åŠ¡
});

console.log('4'); // åŒæ­¥ä»»åŠ¡

// è¾“å‡º: 1 â†’ 4 â†’ 3 â†’ 2
            </div>

            <h3>ç¤ºä¾‹ 2: å¤æ‚åµŒå¥—</h3>
            <div class="code-block">
console.log('å¼€å§‹');

setTimeout(() => {
    console.log('å®ä»»åŠ¡1');
    Promise.resolve().then(() => {
        console.log('å®ä»»åŠ¡1ä¸­çš„å¾®ä»»åŠ¡');
    });
}, 0);

Promise.resolve().then(() => {
    console.log('å¾®ä»»åŠ¡1');
    setTimeout(() => {
        console.log('å¾®ä»»åŠ¡1ä¸­çš„å®ä»»åŠ¡');
    }, 0);
});

console.log('ç»“æŸ');

// è¾“å‡º: å¼€å§‹ â†’ ç»“æŸ â†’ å¾®ä»»åŠ¡1 â†’ å®ä»»åŠ¡1 â†’ å®ä»»åŠ¡1ä¸­çš„å¾®ä»»åŠ¡ â†’ å¾®ä»»åŠ¡1ä¸­çš„å®ä»»åŠ¡
            </div>
        </div>

        <div class="example">
            <h2>ğŸ” å…³é”®è¦ç‚¹</h2>
            <ul>
                <li><strong>åŒæ­¥ä¼˜å…ˆ</strong>ï¼šåŒæ­¥ä»£ç æ€»æ˜¯æœ€å…ˆæ‰§è¡Œ</li>
                <li><strong>å¾®ä»»åŠ¡ä¼˜å…ˆ</strong>ï¼šå¾®ä»»åŠ¡é˜Ÿåˆ—ä¼šåœ¨å®ä»»åŠ¡ä¹‹å‰æ¸…ç©º</li>
                <li><strong>é€ä¸ªæ‰§è¡Œ</strong>ï¼šæ¯æ¬¡åªæ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡ï¼Œä½†ä¼šæ‰§è¡Œæ‰€æœ‰å¾®ä»»åŠ¡</li>
                <li><strong>å¾ªç¯æœºåˆ¶</strong>ï¼šä¸æ–­å¾ªç¯æ£€æŸ¥é˜Ÿåˆ—ï¼Œç›´åˆ°æ‰€æœ‰ä»»åŠ¡å®Œæˆ</li>
            </ul>
        </div>
    </div>

    <script>
        let outputElement = document.getElementById('output');
        let callStackElement = document.getElementById('call-stack');
        let microQueueElement = document.getElementById('micro-queue');
        let macroQueueElement = document.getElementById('macro-queue');
        
        let taskCounter = 0;
        
        function addOutput(text, type = 'normal') {
            const div = document.createElement('div');
            div.textContent = `${++taskCounter}. ${text}`;
            div.style.color = type === 'sync' ? '#ff5722' : 
                             type === 'micro' ? '#9c27b0' : 
                             type === 'macro' ? '#ff9800' : '#4caf50';
            outputElement.appendChild(div);
            outputElement.scrollTop = outputElement.scrollHeight;
        }
        
        function addToQueue(queueElement, text, type) {
            const div = document.createElement('div');
            div.className = 'task-item';
            div.textContent = text;
            div.style.borderLeftColor = type === 'sync' ? '#ff5722' : 
                                       type === 'micro' ? '#9c27b0' : '#ff9800';
            queueElement.appendChild(div);
            
            setTimeout(() => {
                div.classList.add('executing');
                setTimeout(() => {
                    div.remove();
                }, 500);
            }, 100);
        }
        
        function clearOutput() {
            outputElement.innerHTML = '<div>æ§åˆ¶å°è¾“å‡ºå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>';
            callStackElement.innerHTML = '';
            microQueueElement.innerHTML = '';
            macroQueueElement.innerHTML = '';
            taskCounter = 0;
        }
        
        function runBasicExample() {
            clearOutput();
            addOutput('=== åŸºç¡€ç¤ºä¾‹å¼€å§‹ ===');
            
            // æ¨¡æ‹Ÿæ‰§è¡Œè¿‡ç¨‹
            addToQueue(callStackElement, 'console.log("1")', 'sync');
            addOutput('1', 'sync');
            
            addToQueue(macroQueueElement, 'setTimeout callback', 'macro');
            
            addToQueue(microQueueElement, 'Promise.then', 'micro');
            
            addToQueue(callStackElement, 'console.log("4")', 'sync');
            setTimeout(() => addOutput('4', 'sync'), 200);
            
            setTimeout(() => addOutput('3', 'micro'), 400);
            setTimeout(() => addOutput('2', 'macro'), 600);
        }
        
        function runComplexExample() {
            clearOutput();
            addOutput('=== å¤æ‚ç¤ºä¾‹å¼€å§‹ ===');
            
            let delay = 0;
            
            setTimeout(() => {
                addOutput('å¼€å§‹', 'sync');
                addToQueue(callStackElement, 'console.log("å¼€å§‹")', 'sync');
            }, delay += 100);
            
            setTimeout(() => {
                addToQueue(macroQueueElement, 'setTimeout 1', 'macro');
                addToQueue(microQueueElement, 'Promise 1', 'micro');
            }, delay += 100);
            
            setTimeout(() => {
                addOutput('ç»“æŸ', 'sync');
                addToQueue(callStackElement, 'console.log("ç»“æŸ")', 'sync');
            }, delay += 100);
            
            setTimeout(() => {
                addOutput('å¾®ä»»åŠ¡1', 'micro');
            }, delay += 200);
            
            setTimeout(() => {
                addOutput('å®ä»»åŠ¡1', 'macro');
                addToQueue(microQueueElement, 'åµŒå¥—å¾®ä»»åŠ¡', 'micro');
            }, delay += 200);
            
            setTimeout(() => {
                addOutput('å®ä»»åŠ¡1ä¸­çš„å¾®ä»»åŠ¡', 'micro');
            }, delay += 200);
        }
        
        function runNestedExample() {
            clearOutput();
            addOutput('=== åµŒå¥—ç¤ºä¾‹å¼€å§‹ ===');
            
            console.log('Script start');
            addOutput('Script start', 'sync');
            
            setTimeout(() => {
                console.log('Timeout 1');
                addOutput('Timeout 1', 'macro');
                
                Promise.resolve().then(() => {
                    console.log('Promise in timeout');
                    addOutput('Promise in timeout', 'micro');
                });
            }, 0);
            
            Promise.resolve().then(() => {
                console.log('Promise 1');
                addOutput('Promise 1', 'micro');
                
                return Promise.resolve();
            }).then(() => {
                console.log('Promise 2');
                addOutput('Promise 2', 'micro');
            });
            
            setTimeout(() => {
                console.log('Timeout 2');
                addOutput('Timeout 2', 'macro');
            }, 0);
            
            console.log('Script end');
            addOutput('Script end', 'sync');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„æç¤º
        window.addEventListener('load', () => {
            addOutput('é¡µé¢åŠ è½½å®Œæˆï¼Œç‚¹å‡»æŒ‰é’®å¼€å§‹æ¼”ç¤ºï¼');
        });
    </script>
</body>
</html>
